---
phase: 03-operational-hygiene
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/telemetry/telemetry.go
  - internal/transfer/transfer.go
autonomous: true

must_haves:
  truths:
    - "Startup logs indicate when telemetry is disabled"
    - "No telemetry warning logged when OTEL_ADDRESS is set"
    - "Commented-out recovery code in transfer.go is removed"
  artifacts:
    - path: "internal/telemetry/telemetry.go"
      provides: "Info-level log when telemetry disabled"
      contains: "Telemetry disabled"
    - path: "internal/transfer/transfer.go"
      provides: "Clean code without commented-out sections"
  key_links:
    - from: "internal/telemetry/telemetry.go"
      to: "noop.NewMeterProvider()"
      via: "conditional log before noop fallback"
      pattern: "slog\\.Info.*Telemetry disabled"
---

<objective>
Add telemetry status logging and remove commented-out recovery code.

Purpose: Operational visibility - operators should know when telemetry is disabled. Code hygiene - commented-out code should be removed or implemented, not left as dead weight.

Output: Info-level log when telemetry disabled (silent when enabled), removal of 25+ lines of commented-out recovery code from transfer.go.
</objective>

<execution_context>
@/Users/italovietro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/italovietro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-operational-hygiene/03-CONTEXT.md

@internal/telemetry/telemetry.go
@internal/transfer/transfer.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add telemetry disabled logging</name>
  <files>internal/telemetry/telemetry.go</files>
  <action>
In the New() function, add an Info-level log when telemetry is disabled (OTEL_ADDRESS is empty).

Currently the code does:
```go
var meterProvider metric.MeterProvider
meterProvider = noop.NewMeterProvider()

if cfg.OTELAddress != "" {
    // ... create real provider
}
```

Change to:
```go
var meterProvider metric.MeterProvider

if cfg.OTELAddress == "" {
    slog.Info("Telemetry disabled - metrics and traces will not be collected")
    meterProvider = noop.NewMeterProvider()
} else {
    // ... create real provider (existing code)
    meterProvider = sdkmetric.NewMeterProvider(...)
}
```

Import "log/slog" at the top of the file if not already imported.

Key decisions from CONTEXT.md:
- Log at Info level (not Warning) - telemetry is optional, not critical
- Message includes fact + impact: "Telemetry disabled - metrics and traces will not be collected"
- Silent when enabled (no log when OTEL_ADDRESS is set)
  </action>
  <verify>
Run `go build ./...` - should compile without errors.
Grep for "Telemetry disabled" in telemetry.go to confirm log exists.
  </verify>
  <done>
Info-level log "Telemetry disabled - metrics and traces will not be collected" appears when OTEL_ADDRESS is empty. No log when telemetry is enabled.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove commented-out recovery code</name>
  <files>internal/transfer/transfer.go</files>
  <action>
Remove the commented-out recovery code block in ProduceTransfers() function, approximately lines 96-123.

The block to remove starts with:
```go
// We only need to check if something has been imported...
```

And ends with:
```go
// logger.Info("done checking for unfinished transfers. Starting to monitor transfers.", "count", len(transfers))
```

This is approximately 25 lines of commented-out code that checks for unfinished transfers at startup. Per CONTEXT.md, this code should be removed (not implemented) as the current behavior is intentional - the system relies on the polling loop to pick up transfers rather than startup recovery.

Keep the preceding line:
```go
logger.Info("checking unfinished transfers", "label", o.label)
```

The go func() block that follows the commented code should remain unchanged.
  </action>
  <verify>
Run `go build ./...` - should compile without errors.
Run `grep -c "// transfers, err := o.dc.GetTaggedTorrents" internal/transfer/transfer.go` - should return 0 (line removed).
Count lines in file before and after - should be ~25 lines fewer.
  </verify>
  <done>
Commented-out recovery code (lines 96-123) removed from transfer.go. File is cleaner with no dead code. Application compiles successfully.
  </done>
</task>

</tasks>

<verification>
1. `go build ./...` compiles successfully
2. `go vet ./...` passes with no issues
3. `grep -n "Telemetry disabled" internal/telemetry/telemetry.go` shows the log statement
4. `grep -c "// transfers, err := o.dc.GetTaggedTorrents" internal/transfer/transfer.go` returns 0
5. transfer.go has no large commented-out code blocks
</verification>

<success_criteria>
- Telemetry disabled message logged at Info level when OTEL_ADDRESS is empty
- No log when telemetry is enabled (OTEL_ADDRESS is set)
- Commented-out recovery code removed from transfer.go (approximately 25 lines)
- Code compiles and passes vet
</success_criteria>

<output>
After completion, create `.planning/phases/03-operational-hygiene/03-02-SUMMARY.md`
</output>
