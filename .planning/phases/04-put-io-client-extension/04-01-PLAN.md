---
phase: 04-put-io-client-extension
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/transfer/errors.go
autonomous: true

must_haves:
  truths:
    - "Custom error types can be inspected with errors.As to determine failure category"
    - "Error messages include actionable context (filename, directory, status code)"
    - "Error types implement Unwrap() to preserve error chains"
  artifacts:
    - path: "internal/transfer/errors.go"
      provides: "Four custom error types for transfer failures"
      exports: ["InvalidContentError", "NetworkError", "DirectoryError", "AuthenticationError"]
  key_links:
    - from: "internal/transfer/errors.go"
      to: "errors package"
      via: "Unwrap() method"
      pattern: "func.*Unwrap.*error"
---

<objective>
Create custom error types for transfer operations in the internal/transfer package.

Purpose: Enable programmatic error handling by distinguishing between four failure categories: invalid content, network/API, directory resolution, and authentication. This foundation is required before extending the Put.io client in Plan 02.

Output: `internal/transfer/errors.go` with four error types implementing Go 1.13+ error patterns.
</objective>

<execution_context>
@/Users/italovietro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/italovietro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-put-io-client-extension/04-RESEARCH.md (Pattern 2: Custom Error Types, Pattern 3: Error Inspection)
@internal/transfer/transfer.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create custom error types for transfer operations</name>
  <files>internal/transfer/errors.go</files>
  <action>
Create `internal/transfer/errors.go` with four struct-based error types:

1. **InvalidContentError** - For malformed .torrent files or Put.io rejection
   - Fields: `Filename string`, `Reason string`, `Err error`
   - Error() format: "invalid torrent content in {filename}: {reason}"
   - Use case: size exceeds 10MB, missing .torrent extension, Put.io rejects content

2. **NetworkError** - For network failures and API errors (5xx, timeouts)
   - Fields: `Operation string`, `StatusCode int`, `APIMessage string`, `Err error`
   - Error() format: "network error during {operation} (HTTP {status}): {message}"
   - Use case: Put.io API returns 5xx, connection timeout, rate limit

3. **DirectoryError** - For directory resolution failures
   - Fields: `DirectoryName string`, `Reason string`, `Err error`
   - Error() format: "directory error for '{directory}': {reason}"
   - Use case: directory not found, not a directory, access denied

4. **AuthenticationError** - For auth failures (401, 403)
   - Fields: `Operation string`, `Err error`
   - Error() format: "authentication failed during {operation}"
   - Use case: invalid/expired API token

All error types must:
- Implement `error` interface with `Error() string` method
- Implement `Unwrap() error` method returning the wrapped `Err` field
- Use pointer receivers for consistency with Go patterns
- Be exported (uppercase names) for use by Put.io client

Follow existing package conventions in `internal/transfer/transfer.go` (imports, formatting).
  </action>
  <verify>
Run `go build ./...` - compilation succeeds with no errors.
Run `go vet ./internal/transfer/...` - no vet warnings.
  </verify>
  <done>
Four custom error types defined in `internal/transfer/errors.go`:
- InvalidContentError with Filename, Reason, Err fields
- NetworkError with Operation, StatusCode, APIMessage, Err fields
- DirectoryError with DirectoryName, Reason, Err fields
- AuthenticationError with Operation, Err fields
All implement Error() and Unwrap() methods.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add unit tests for error types</name>
  <files>internal/transfer/errors_test.go</files>
  <action>
Create `internal/transfer/errors_test.go` with tests verifying:

1. **Error() method output** - Test each error type formats message correctly
   - InvalidContentError: "invalid torrent content in test.torrent: file too large"
   - NetworkError: "network error during upload (HTTP 503): service unavailable"
   - DirectoryError: "directory error for 'itv': not found"
   - AuthenticationError: "authentication failed during upload_torrent"

2. **Unwrap() method** - Test that wrapped errors are extractable
   - Create error with wrapped cause
   - Verify `errors.Unwrap()` returns the wrapped error
   - Verify `errors.Is()` works through the chain

3. **errors.As() inspection** - Test programmatic error type detection
   - Wrap error with `fmt.Errorf("context: %w", &InvalidContentError{...})`
   - Verify `errors.As(err, &target)` extracts the typed error
   - Verify extracted error has expected field values

Use `testing` package and `errors` package for assertions.
Match existing test patterns in the codebase (if any exist in internal/transfer/).
  </action>
  <verify>
Run `go test ./internal/transfer/... -v` - all tests pass.
  </verify>
  <done>
Unit tests verify:
- Error() returns correctly formatted strings for all 4 types
- Unwrap() enables error chain traversal
- errors.As() extracts typed errors from wrapped chains
  </done>
</task>

</tasks>

<verification>
1. `go build ./...` compiles successfully
2. `go vet ./internal/transfer/...` reports no issues
3. `go test ./internal/transfer/...` passes all tests
4. Error types are exported and usable from other packages
</verification>

<success_criteria>
- Four custom error types defined with proper fields
- All error types implement error interface and Unwrap()
- Unit tests demonstrate errors.As() works for type inspection
- Code follows Go 1.13+ error handling patterns
</success_criteria>

<output>
After completion, create `.planning/phases/04-put-io-client-extension/04-01-SUMMARY.md`
</output>
