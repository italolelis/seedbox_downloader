---
phase: 07-trace-correlation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/dc/putio/client.go
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All logging calls in putio/client.go use context-aware methods"
    - "Put.io operations include trace_id/span_id in logs when tracing is active"
  artifacts:
    - path: "internal/dc/putio/client.go"
      provides: "Complete context-aware logging in Put.io client"
      contains: "ErrorContext|DebugContext"
      not_contains: "logger.Error\\(|logger.Debug\\("
  key_links:
    - from: "internal/dc/putio/client.go"
      to: "internal/logctx/trace_handler.go"
      via: "context propagation through *Context methods"
      pattern: "Context\\(ctx,"
---

<objective>
Complete the Put.io client migration to context-aware logging by fixing 8 remaining non-context logging calls.

Purpose: Verification found that 8 logging calls in putio/client.go still use logger.Error()/Debug() instead of ErrorContext()/DebugContext(), preventing trace correlation for Put.io operations.

Output: All Put.io client logging will include trace_id/span_id when OpenTelemetry tracing is active.
</objective>

<execution_context>
@/Users/italovietro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/italovietro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Gap source
@.planning/phases/07-trace-correlation/07-VERIFICATION.md

# File to fix
@internal/dc/putio/client.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate remaining Put.io logging calls to context-aware methods</name>
  <files>internal/dc/putio/client.go</files>
  <action>
Migrate 8 non-context logging calls to context-aware methods. Each change adds "Context" suffix and "ctx" as first argument:

**In GetTaggedTorrents function:**
- Line 44: `logger.Error("failed to get transfers"` -> `logger.ErrorContext(ctx, "failed to get transfers"`
- Line 53: `logger.Debug("skipping transfer because` -> `logger.DebugContext(ctx, "skipping transfer because`
- Line 60: `logger.Error("failed to get file"` -> `logger.ErrorContext(ctx, "failed to get file"`
- Line 67: `logger.Error("failed to get parent file"` -> `logger.ErrorContext(ctx, "failed to get parent file"`
- Line 73: `logger.Debug("skipping file"` -> `logger.DebugContext(ctx, "skipping file"`
- Line 106: `logger.Debug("found torrents to download"` -> `logger.DebugContext(ctx, "found torrents to download"`

**In GrabFile function:**
- Line 117: `logger.Error("failed to get file download url"` -> `logger.ErrorContext(ctx, "failed to get file download url"`
- Line 124: `logger.Error("failed to get file"` -> `logger.ErrorContext(ctx, "failed to get file"`

All 8 functions already have `ctx context.Context` as a parameter, so ctx is available.
  </action>
  <verify>
Run: `grep -n 'logger\.\(Error\|Debug\|Info\)(' internal/dc/putio/client.go | grep -v Context`
Expected: No output (all logging calls should include "Context")

Run: `go build ./...`
Expected: Build succeeds with no errors
  </verify>
  <done>
- 0 non-context logging calls remain in putio/client.go
- All 8 previously non-context calls now use *Context methods
- Build passes
  </done>
</task>

</tasks>

<verification>
Run these checks after task completion:

1. **No non-context logging calls:**
   ```bash
   grep -n 'logger\.\(Error\|Debug\|Info\)(' internal/dc/putio/client.go | grep -v Context
   ```
   Expected: No output

2. **Count context-aware calls (should be 19 total):**
   ```bash
   grep -c 'Context(ctx,' internal/dc/putio/client.go
   ```
   Expected: 19 (11 existing + 8 migrated)

3. **Build verification:**
   ```bash
   go build ./...
   ```
   Expected: Success

4. **Test verification:**
   ```bash
   go test ./internal/dc/putio/... -v
   ```
   Expected: All tests pass (if any exist)
</verification>

<success_criteria>
- [ ] All 8 non-context logging calls in putio/client.go migrated to *Context methods
- [ ] grep confirms 0 non-context logging calls remain
- [ ] go build ./... succeeds
- [ ] Tests pass (if any)
</success_criteria>

<output>
After completion, create `.planning/phases/07-trace-correlation/07-04-SUMMARY.md`
</output>
